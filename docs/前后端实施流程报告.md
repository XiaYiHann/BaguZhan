# "å…«è‚¡æ–©" å‰åç«¯å®æ–½æµç¨‹æŠ¥å‘Š

## ğŸ“‹ é¡¹ç›®æ¦‚è§ˆ

**é¡¹ç›®åç§°**: å…«è‚¡æ–©
**é¡¹ç›®å®šä½**: ç»“åˆ AI å®æ—¶ç”Ÿæˆä¸æç®€æ¼«ç”»è§†è§‰é£æ ¼çš„ç¨‹åºå‘˜é¢è¯•å‡†å¤‡å·¥å…·
**æ ¸å¿ƒç›®æ ‡**: ä»¥é«˜é¢‘åé¦ˆçš„"æ–©é¢˜"ä½“éªŒæå‡ç”¨æˆ·å¯¹é¢è¯•çŸ¥è¯†ç‚¹çš„è®°å¿†ä¸ç†è§£

### æŠ€æœ¯æ ˆ

| å±‚çº§ | æŠ€æœ¯é€‰å‹ |
|------|---------|
| å®¢æˆ·ç«¯ | Flutter + Dartï¼ˆiOS/Android è·¨å¹³å°ï¼‰ |
| åç«¯ | Node.js + TypeScriptï¼ˆBFF/Serverlessï¼‰ |
| AI èƒ½åŠ› | Gemini API |
| æ•°æ®å­˜å‚¨ | Firestoreï¼ˆå¯é€‰ï¼‰ |
| è®¾è®¡é£æ ¼ | æ·¡è‰²ç³» + å¤šé‚»å›½é£æ ¼ |

---

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Flutter å®¢æˆ·ç«¯                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚  UI å±‚    â”‚  â”‚ çŠ¶æ€ç®¡ç†å±‚ â”‚  â”‚ æ•°æ®è®¿é—®å±‚ â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              BFF å±‚ (Node.js + TypeScript)               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”‚
â”‚  â”‚   é‰´æƒ    â”‚  â”‚ Prompt    â”‚  â”‚ è¾“å‡ºæ ¡éªŒ  â”‚           â”‚
â”‚  â”‚   é™æµ    â”‚  â”‚ æ¨¡æ¿ç®¡ç†  â”‚  â”‚ ç¼“å­˜ç­–ç•¥  â”‚           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â–¼                 â–¼                 â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Gemini API   â”‚  â”‚  Firestore    â”‚  â”‚  å…¶ä»–æœåŠ¡     â”‚
â”‚  (AI ç”Ÿæˆ)    â”‚  â”‚  (æ•°æ®å­˜å‚¨)   â”‚  â”‚               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### åˆ†å±‚èŒè´£

#### Flutter å®¢æˆ·ç«¯
- **UI å±‚**: è´Ÿè´£ç•Œé¢æ¸²æŸ“ä¸ç”¨æˆ·äº¤äº’
- **çŠ¶æ€ç®¡ç†å±‚**: é¢˜ç›®æµè½¬ã€ç­”é¢˜çŠ¶æ€ã€åŠ è½½çŠ¶æ€
- **æ•°æ®è®¿é—®å±‚**: API è°ƒç”¨ã€æ•°æ®ç¼“å­˜ã€é”™è¯¯å¤„ç†

#### BFF å±‚
- **é‰´æƒ**: ç”¨æˆ·èº«ä»½éªŒè¯ä¸æˆæƒ
- **é™æµ**: API è°ƒç”¨é¢‘ç‡æ§åˆ¶
- **Prompt æ¨¡æ¿**: ç»“æ„åŒ– Prompt ç®¡ç†
- **è¾“å‡ºæ ¡éªŒ**: AI è¿”å›ç»“æœæ ¼å¼éªŒè¯
- **ç¼“å­˜ç­–ç•¥**: å‡å°‘é‡å¤ API è°ƒç”¨

---

## ğŸ”„ å¼€å‘æµç¨‹

### æ ¸å¿ƒåŸåˆ™

1. **TDD ä¼˜å…ˆ**: å…ˆå†™æµ‹è¯• â†’ å®ç° â†’ é‡æ„
2. **OpenSpec é©±åŠ¨**: å˜æ›´ä»¥ææ¡ˆé©±åŠ¨
3. **çŸ­åˆ†æ”¯å¼€å‘**: åŸºäºä¸»åˆ†æ”¯çš„çŸ­åˆ†æ”¯
4. **æµ‹è¯•å…ˆè¡Œ**: åˆå¹¶å‰ç¡®ä¿æµ‹è¯•é€šè¿‡

### å¼€å‘æµç¨‹å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ éœ€æ±‚/ææ¡ˆ   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ åˆ›å»ºææ¡ˆ    â”‚ â”€â”€â–¶ â”‚ ææ¡ˆè¯„å®¡    â”‚
â”‚ (OpenSpec)  â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜            â”‚
       â–¼                   â–¼
       â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚            â”‚ ææ¡ˆé€šè¿‡    â”‚
       â”‚            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â–¼
       â”‚            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   TDD å¼€å§‹   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
                           â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â–¼                         â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ å†™æµ‹è¯•ç”¨ä¾‹  â”‚          â”‚ åç«¯å¼€å‘    â”‚
       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â”‚ (BFF + API) â”‚
              â”‚                 â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
              â–¼                        â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ å‰ç«¯å¼€å‘    â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚ é›†æˆæµ‹è¯•    â”‚
       â”‚ (Flutter)   â”‚          â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                 â”‚
              â”‚                        â–¼
              â–¼                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚ æµ‹è¯•é€šè¿‡?   â”‚
       â”‚ ä»£ç å®¡æŸ¥    â”‚ â”€â”€No â”€â”€â”€â–¶â”‚      â”‚      â”‚
       â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”˜
              â”‚                        â”‚ Yes
              â–¼                        â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚ åˆå¹¶ä¸»åˆ†æ”¯  â”‚ â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚  åˆå¹¶ PR    â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“ å…·ä½“å®æ–½æ­¥éª¤

### é‡Œç¨‹ç¢‘ M1: åŸºç¡€ UI åŸå‹ï¼ˆæ—  AIï¼‰

**ç›®æ ‡**: ç”¨æˆ·å¯å®Œæˆå®Œæ•´ç­”é¢˜å¾ªç¯ï¼Œåé¦ˆæ­£ç¡®/é”™è¯¯çŠ¶æ€

#### 1.1 ç¯å¢ƒæ­å»º

```bash
# Flutter ç¯å¢ƒæ£€æŸ¥
flutter doctor

# åˆ›å»ºé¡¹ç›®
flutter create baguzhan
cd baguzhan

# é…ç½®ä¾èµ–ï¼ˆpubspec.yamlï¼‰
```

**æ ¸å¿ƒä¾èµ–**:
```yaml
dependencies:
  flutter:
    sdk: flutter
  # çŠ¶æ€ç®¡ç†
  provider: ^6.1.0
  # ç½‘ç»œè¯·æ±‚
  dio: ^5.4.0
  # UI ç»„ä»¶
  flutter_svg: ^2.0.0

dev_dependencies:
  flutter_test:
    sdk: flutter
  flutter_lints: ^3.0.0
  mockito: ^5.4.0
```

#### 1.2 é¡¹ç›®ç»“æ„

```
lib/
â”œâ”€â”€ main.dart
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ constants/
â”‚   â”œâ”€â”€ theme/
â”‚   â””â”€â”€ utils/
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ models/
â”‚   â”œâ”€â”€ repositories/
â”‚   â””â”€â”€ datasources/
â”œâ”€â”€ domain/
â”‚   â”œâ”€â”€ entities/
â”‚   â””â”€â”€ usecases/
â”œâ”€â”€ presentation/
â”‚   â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ widgets/
â”‚   â””â”€â”€ providers/
â””â”€â”€ tests/
    â”œâ”€â”€ unit/
    â”œâ”€â”€ widget/
    â””â”€â”€ integration/
```

#### 1.3 TDD å¼€å‘æµç¨‹

**ç¤ºä¾‹: é¢˜ç›®çŠ¶æ€æœºæµ‹è¯•**

```dart
// test/unit/question_state_test.dart
void main() {
  group('QuestionState', () {
    test('åˆå§‹çŠ¶æ€åº”ä¸ºå¾…å›ç­”', () {
      final state = QuestionState.initial();
      expect(state.status, QuestionStatus.pending);
    });

    test('é€‰æ‹©é€‰é¡¹åå˜ä¸ºå·²å›ç­”', () {
      final state = QuestionState.initial();
      final newState = state.selectOption(0);
      expect(newState.status, QuestionStatus.answered);
    });

    test('æäº¤ç­”æ¡ˆååˆ¤æ–­æ­£ç¡®æ€§', () {
      final state = QuestionState.initial();
      final newState = state.selectOption(0).submit();
      expect(newState.status, QuestionStatus.submitted);
      expect(newState.isCorrect, isNotNull);
    });
  });
}
```

**å®ç°ä»£ç **:

```dart
// lib/domain/entities/question_state.dart
enum QuestionStatus { pending, answered, submitted }

class QuestionState {
  final QuestionStatus status;
  final int? selectedOption;
  final bool? isCorrect;

  QuestionState({
    required this.status,
    this.selectedOption,
    this.isCorrect,
  });

  factory QuestionState.initial() {
    return QuestionState(status: QuestionStatus.pending);
  }

  QuestionState selectOption(int index) {
    return QuestionState(
      status: QuestionStatus.answered,
      selectedOption: index,
    );
  }

  QuestionState submit() {
    // æ¨¡æ‹Ÿåˆ¤æ–­é€»è¾‘
    return QuestionState(
      status: QuestionStatus.submitted,
      selectedOption: selectedOption,
      isCorrect: selectedOption == 0, // å‡è®¾ç¬¬ä¸€é¡¹æ­£ç¡®
    );
  }
}
```

#### 1.4 UI ç»„ä»¶æµ‹è¯•

```dart
// test/widget/question_card_test.dart
void main() {
  testWidgets('æ˜¾ç¤ºé¢˜ç›®å†…å®¹', (WidgetTester tester) async {
    await tester.pumpWidget(
      MaterialApp(
        home: QuestionCard(
          question: QuestionModel(
            content: 'ä»€ä¹ˆæ˜¯é—­åŒ…ï¼Ÿ',
            options: ['A', 'B', 'C', 'D'],
          ),
        ),
      ),
    );

    expect(find.text('ä»€ä¹ˆæ˜¯é—­åŒ…ï¼Ÿ'), findsOneWidget);
    expect(find.text('A'), findsOneWidget);
  });
}
```

#### 1.5 å›ºå®šé¢˜ç›®æ•°æ®

```dart
// lib/data/datasources/mock_question_datasource.dart
class MockQuestionDatasource {
  List<QuestionModel> getMockQuestions() {
    return [
      QuestionModel(
        id: '1',
        content: 'JavaScript ä¸­ typeof null è¿”å›ä»€ä¹ˆï¼Ÿ',
        options: ['"null"', '"undefined"', '"object"', '"number"'],
        correctAnswer: 2,
        explanation: 'è¿™æ˜¯ JavaScript çš„ä¸€ä¸ªå†å²é—ç•™é—®é¢˜...',
        mnemonic: 'null æ˜¯ç©ºå¯¹è±¡ï¼Œæ‰€ä»¥ç±»å‹æ˜¯ object',
        scenario: 'é¢è¯•è¿½é—®ï¼šä¸ºä»€ä¹ˆ typeof null === "object"ï¼Ÿ',
      ),
      // æ›´å¤šå›ºå®šé¢˜ç›®...
    ];
  }
}
```

---

### é‡Œç¨‹ç¢‘ M2: æ¥å…¥ BFF + Gemini API

**ç›®æ ‡**: AI ç”Ÿæˆé¢˜ç›®ã€è§£æã€åŠ©è®°ä¸å®æˆ˜åœºæ™¯

#### 2.1 BFF é¡¹ç›®åˆå§‹åŒ–

```bash
# åˆ›å»º BFF é¡¹ç›®
mkdir baguzhan-bff
cd baguzhan-bff
npm init -y

# å®‰è£…ä¾èµ–
npm install express typescript @types/node @types/express ts-node
npm install google generative-ai dotenv
npm install @google-cloud/firestore

# å¼€å‘ä¾èµ–
npm install -D eslint prettier jest @types/jest ts-jest
```

#### 2.2 BFF é¡¹ç›®ç»“æ„

```
bff/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ index.ts
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ questions.ts
â”‚   â”‚   â””â”€â”€ health.ts
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ gemini.service.ts
â”‚   â”‚   â””â”€â”€ prompt.service.ts
â”‚   â”œâ”€â”€ middleware/
â”‚   â”‚   â”œâ”€â”€ auth.ts
â”‚   â”‚   â”œâ”€â”€ rateLimit.ts
â”‚   â”‚   â””â”€â”€ validator.ts
â”‚   â”œâ”€â”€ validators/
â”‚   â””â”€â”€ types/
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ unit/
â”‚   â””â”€â”€ integration/
â””â”€â”€ dist/
```

#### 2.3 Prompt æ¨¡æ¿è®¾è®¡

```typescript
// src/services/prompt.service.ts
export class PromptService {
  private generateQuestionPrompt = (
    topic: string,
    difficulty: string
  ): string => `
ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„æŠ€æœ¯é¢è¯•å®˜ã€‚è¯·æ ¹æ®ä»¥ä¸‹è¦æ±‚ç”Ÿæˆä¸€é“é¢è¯•é¢˜ï¼š

ä¸»é¢˜ï¼š${topic}
éš¾åº¦ï¼š${difficulty}

è¯·ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹ JSON æ ¼å¼è¿”å›ï¼š
{
  "id": "å”¯ä¸€æ ‡è¯†",
  "content": "é¢˜ç›®å†…å®¹",
  "options": ["é€‰é¡¹A", "é€‰é¡¹B", "é€‰é¡¹C", "é€‰é¡¹D"],
  "correctAnswer": æ­£ç¡®ç­”æ¡ˆç´¢å¼•ï¼ˆ0-3ï¼‰,
  "explanation": "è¯¦ç»†è§£æï¼Œ300å­—ä»¥å†…",
  "mnemonic": "åŠ©è®°å£è¯€ï¼Œä¸€å¥è¯",
  "scenario": "é¢è¯•å¯èƒ½çš„è¿½é—®åœºæ™¯"
}

æ³¨æ„ï¼š
1. é¢˜ç›®è¦è´´è¿‘å®é™…é¢è¯•åœºæ™¯
2. é€‰é¡¹è¦å…·æœ‰è¿·æƒ‘æ€§
3. è§£æè¦å‡†ç¡®æ˜“æ‡‚
4. åŠ©è®°è¦æœ—æœ—ä¸Šå£
`;

  async generateQuestion(topic: string, difficulty: string) {
    const prompt = this.generateQuestionPrompt(topic, difficulty);
    return this.geminiService.generate(prompt);
  }
}
```

#### 2.4 Gemini æœåŠ¡é›†æˆ

```typescript
// src/services/gemini.service.ts
import { GoogleGenerativeAI } from '@google/google-ai-apis';

export class GeminiService {
  private model: GenerativeModel;

  constructor() {
    const genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY!);
    this.model = genAI.getGenerativeModel({ model: 'gemini-pro' });
  }

  async generate(prompt: string): Promise<any> {
    try {
      const result = await this.model.generateContent(prompt);
      const response = await result.response;
      const text = response.text();

      // è§£æ JSON
      const cleanText = text.replace(/```json\n?/g, '').replace(/```\n?/g, '');
      return JSON.parse(cleanText);
    } catch (error) {
      throw new Error(`Gemini API è°ƒç”¨å¤±è´¥: ${error}`);
    }
  }
}
```

#### 2.5 è¾“å‡ºæ ¡éªŒä¸­é—´ä»¶

```typescript
// src/middleware/validator.ts
import { Schema } from 'jsonschema';

const questionSchema: Schema = {
  type: 'object',
  required: ['id', 'content', 'options', 'correctAnswer', 'explanation'],
  properties: {
    id: { type: 'string' },
    content: { type: 'string' },
    options: {
      type: 'array',
      items: { type: 'string' },
      minItems: 4,
      maxItems: 4,
    },
    correctAnswer: { type: 'number', minimum: 0, maximum: 3 },
    explanation: { type: 'string' },
  },
};

export function validateAIOutput(req, res, next) {
  const validate = new Validator();
  const result = validate.validate(req.body, questionSchema);

  if (!result.valid) {
    return res.status(400).json({
      error: 'AI è¾“å‡ºæ ¼å¼ä¸æ­£ç¡®',
      details: result.errors,
    });
  }
  next();
}
```

#### 2.6 é™æµä¸­é—´ä»¶

```typescript
// src/middleware/rateLimit.ts
import rateLimit from 'express-rate-limit';

export const aiRateLimiter = rateLimit({
  windowMs: 60 * 1000, // 1åˆ†é’Ÿ
  max: 10, // æœ€å¤š10æ¬¡è¯·æ±‚
  message: 'AI ç”Ÿæˆè¯·æ±‚è¿‡äºé¢‘ç¹ï¼Œè¯·ç¨åå†è¯•',
});
```

#### 2.7 API è·¯ç”±

```typescript
// src/routes/questions.ts
import express from 'express';
import { PromptService } from '../services/prompt.service';
import { aiRateLimiter } from '../middleware/rateLimit';
import { validateAIOutput } from '../middleware/validator';

const router = express.Router();
const promptService = new PromptService();

router.post('/generate', aiRateLimiter, async (req, res) => {
  try {
    const { topic, difficulty } = req.body;

    const question = await promptService.generateQuestion(
      topic,
      difficulty
    );

    // æ ¡éªŒè¾“å‡º
    const validationResult = validateAIOutput(question);
    if (!validationResult.valid) {
      return res.status(500).json({
        error: 'AI ç”Ÿæˆç»“æœæ ¼å¼é”™è¯¯',
        details: validationResult.errors,
      });
    }

    res.json(question);
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
});

export default router;
```

#### 2.8 Flutter é›†æˆ Gemini

```dart
// pubspec.yaml
dependencies:
  google_generative_ai: ^0.4.0

// lib/data/services/gemini_service.dart
import 'package:google_generative_ai/google_generative_ai.dart';

class GeminiService {
  final GenerativeModel _model;

  GeminiService(String apiKey)
      : _model = GenerativeModel(
          model: 'gemini-pro',
          apiKey: apiKey,
        );

  Future<String> generateQuestion(String prompt) async {
    final content = [Content.text(prompt)];
    final response = await _model.generateContent(content);

    return response.text ?? '';
  }
}
```

**æˆ–è€…é€šè¿‡ BFF è°ƒç”¨**:

```dart
// lib/data/repositories/question_repository.dart
import 'package:dio/dio.dart';

class QuestionRepository {
  final Dio _dio;
  final String baseUrl;

  QuestionRepository(this._dio, {this.baseUrl = 'http://localhost:3000'});

  Future<QuestionModel> generateQuestion({
    required String topic,
    required String difficulty,
  }) async {
    try {
      final response = await _dio.post(
        '$baseUrl/api/questions/generate',
        data: {
          'topic': topic,
          'difficulty': difficulty,
        },
      );

      return QuestionModel.fromJson(response.data);
    } catch (e) {
      throw Exception('é¢˜ç›®ç”Ÿæˆå¤±è´¥: $e');
    }
  }
}
```

---

### é‡Œç¨‹ç¢‘ M3: UI è§†è§‰ä¸äº¤äº’ä¼˜åŒ–

**ç›®æ ‡**: UI è§†è§‰ä¸äº¤äº’è¾¾åˆ°å¤šé‚»å›½é£æ ¼ä¸€è‡´çš„è½»æ¾æ„Ÿä¸æµç•…ä½“éªŒ

#### 3.1 å¤šé‚»å›½é£æ ¼è®¾è®¡ç³»ç»Ÿ

```dart
// lib/core/theme/app_theme.dart
class AppTheme {
  static ThemeData get lightTheme {
    return ThemeData(
      // ä¸»è‰²è°ƒ - æ·¡ç»¿è‰²ç³»ï¼ˆç±»ä¼¼å¤šé‚»å›½ï¼‰
      primaryColor: Color(0xFF58CC02),
      primaryColorLight: Color(0xFF89E219),
      primaryColorDark: Color(0xFF58A700),

      // è¾…åŠ©è‰²
      colorScheme: ColorScheme.light(
        primary: Color(0xFF58CC02),
        secondary: Color(0xFF1CB0F6),
        error: Color(0xFFFF4B4B),
        background: Color(0xFFFFFFFF),
        surface: Color(0xFFF7F7F7),
      ),

      // åœ†è§’è®¾è®¡
      cardTheme: CardTheme(
        shape: RoundedRectangleBorder(
          borderRadius: BorderRadius.circular(16),
        ),
        elevation: 0,
      ),

      // æŒ‰é’®æ ·å¼
      elevatedButtonTheme: ElevatedButtonThemeData(
        style: ElevatedButton.styleFrom(
          backgroundColor: Color(0xFF58CC02),
          foregroundColor: Colors.white,
          padding: EdgeInsets.symmetric(horizontal: 24, vertical: 16),
          shape: RoundedRectangleBorder(
            borderRadius: BorderRadius.circular(16),
          ),
          elevation: 0,
        ),
      ),

      // å­—ä½“
      fontFamily: 'Nunito',
      textTheme: TextTheme(
        headlineLarge: TextStyle(
          fontSize: 28,
          fontWeight: FontWeight.bold,
          color: Color(0xFF3C3C3C),
        ),
        bodyLarge: TextStyle(
          fontSize: 16,
          color: Color(0xFF3C3C3C),
        ),
      ),
    );
  }
}
```

#### 3.2 åŠ¨ç”»æ•ˆæœ

```dart
// lib/presentation/widgets/animated_option_card.dart
class AnimatedOptionCard extends StatefulWidget {
  final String option;
  final bool isSelected;
  final bool isCorrect;
  final VoidCallback onTap;

  @override
  _AnimatedOptionCardState createState() => _AnimatedOptionCardState();
}

class _AnimatedOptionCardState extends State<AnimatedOptionCard>
    with SingleTickerProviderStateMixin {
  late AnimationController _controller;
  late Animation<double> _scaleAnimation;
  late Animation<Color?> _colorAnimation;

  @override
  void initState() {
    super.initState();
    _controller = AnimationController(
      duration: Duration(milliseconds: 200),
      vsync: this,
    );

    _scaleAnimation = Tween<double>(begin: 1.0, end: 0.95).animate(
      CurvedAnimation(parent: _controller, curve: Curves.easeInOut),
    );

    _colorAnimation = ColorTween(
      begin: Colors.white,
      end: widget.isCorrect ? Color(0xFF58CC02) : Color(0xFFFF4B4B),
    ).animate(CurvedAnimation(parent: _controller, curve: Curves.easeInOut));
  }

  @override
  Widget build(BuildContext context) {
    return GestureDetector(
      onTapDown: (_) => _controller.forward(),
      onTapUp: (_) {
        _controller.reverse();
        widget.onTap();
      },
      onTapCancel: () => _controller.reverse(),
      child: ScaleTransition(
        scale: _scaleAnimation,
        child: AnimatedBuilder(
          animation: _colorAnimation,
          builder: (context, child) {
            return Container(
              padding: EdgeInsets.all(16),
              decoration: BoxDecoration(
                color: _colorAnimation.value ?? Colors.white,
                border: Border.all(
                  color: widget.isSelected
                      ? (widget.isCorrect ? Color(0xFF58CC02) : Color(0xFFFF4B4B))
                      : Color(0xFFE5E5E5),
                  width: 2,
                ),
                borderRadius: BorderRadius.circular(16),
              ),
              child: Text(
                widget.option,
                style: TextStyle(
                  fontSize: 16,
                  color: widget.isSelected ? Colors.white : Color(0xFF3C3C3C),
                  fontWeight: FontWeight.w600,
                ),
              ),
            );
          },
        ),
      ),
    );
  }

  @override
  void dispose() {
    _controller.dispose();
    super.dispose();
  }
}
```

#### 3.3 åŠ è½½åŠ¨ç”»

```dart
// lib/presentation/widgets/ai_loading_animation.dart
class AILoadingAnimation extends StatefulWidget {
  @override
  _AILoadingAnimationState createState() => _AILoadingAnimationState();
}

class _AILoadingAnimationState extends State<AILoadingAnimation>
    with SingleTickerProviderStateMixin {
  late AnimationController _controller;

  @override
  void initState() {
    super.initState();
    _controller = AnimationController(
      duration: Duration(seconds: 2),
      vsync: this,
    )..repeat();
  }

  @override
  Widget build(BuildContext context) {
    return Column(
      mainAxisAlignment: MainAxisAlignment.center,
      children: [
        Text(
          'AI æ­£åœ¨ä½œç”»...',
          style: TextStyle(
            fontSize: 18,
            fontWeight: FontWeight.w600,
            color: Color(0xFF58CC02),
          ),
        ),
        SizedBox(height: 24),
        CircularProgressIndicator(
          valueColor: AlwaysStoppedAnimation<Color>(Color(0xFF58CC02)),
          strokeWidth: 3,
        ),
        SizedBox(height: 16),
        AnimatedBuilder(
          animation: _controller,
          builder: (context, child) {
            return Text(
              ['ç”Ÿæˆä¸­', 'æ€è€ƒä¸­', 'åˆ›ä½œä¸­'][(_controller.value * 3).floor() % 3],
              style: TextStyle(fontSize: 14, color: Color(0xFF777777)),
            );
          },
        ),
      ],
    );
  }

  @override
  void dispose() {
    _controller.dispose();
    super.dispose();
  }
}
```

#### 3.4 å“åº”å¼å¸ƒå±€

```dart
// lib/presentation/pages/question_page.dart
class QuestionPage extends StatelessWidget {
  @override
  Widget build(BuildContext context) {
    return LayoutBuilder(
      builder: (context, constraints) {
        if (constraints.maxWidth > 600) {
          return _buildTabletLayout();
        } else {
          return _buildMobileLayout();
        }
      },
    );
  }

  Widget _buildMobileLayout() {
    return Scaffold(
      body: SafeArea(
        child: Padding(
          padding: EdgeInsets.all(16),
          child: Column(
            children: [
              _buildProgressIndicator(),
              SizedBox(height: 24),
              _buildQuestionCard(),
              SizedBox(height: 24),
              _buildOptionsList(),
            ],
          ),
        ),
      ),
    );
  }

  Widget _buildTabletLayout() {
    return Scaffold(
      body: Center(
        child: ConstrainedBox(
          constraints: BoxConstraints(maxWidth: 600),
          child: _buildMobileLayout(),
        ),
      ),
    );
  }
}
```

---

### é‡Œç¨‹ç¢‘ M4: æ•°æ®æŒä¹…åŒ–

**ç›®æ ‡**: é”™é¢˜æœ¬ä¸å­¦ä¹ è¿›åº¦å¯æŒä¹…åŒ–ä¸æ£€ç´¢

#### 4.1 Firestore æ•°æ®æ¨¡å‹

```typescript
// Firestore æ•°æ®ç»“æ„è®¾è®¡

// é›†åˆ: users
{
  "userId": "user_123",
  "displayName": "å¼ ä¸‰",
  "createdAt": "2025-01-01T00:00:00Z",
  "totalQuestions": 100,
  "correctRate": 0.75
}

// é›†åˆ: users/{userId}/wrongQuestions
{
  "questionId": "q_123",
  "topic": "JavaScript",
  "difficulty": "medium",
  "wrongCount": 3,
  "lastWrongAt": "2025-01-26T00:00:00Z",
  "isResolved": false
}

// é›†åˆ: users/{userId}/progress
{
  "topic": "JavaScript",
  "totalAnswered": 50,
  "correctCount": 40,
  "currentLevel": "intermediate"
}
```

#### 4.2 Flutter Firestore é›†æˆ

```dart
// pubspec.yaml
dependencies:
  cloud_firestore: ^4.14.0
  firebase_core: ^2.24.0

// lib/data/services/firestore_service.dart
import 'package:cloud_firestore/cloud_firestore.dart';

class FirestoreService {
  final FirebaseFirestore _firestore;

  FirestoreService(this._firestore);

  // ä¿å­˜é”™é¢˜
  Future<void> saveWrongQuestion({
    required String userId,
    required QuestionModel question,
  }) async {
    await _firestore
        .collection('users')
        .doc(userId)
        .collection('wrongQuestions')
        .doc(question.id)
        .set({
      'questionId': question.id,
      'topic': question.topic,
      'difficulty': question.difficulty,
      'wrongCount': FieldValue.increment(1),
      'lastWrongAt': DateTime.now().toIso8601String(),
      'isResolved': false,
    }, SetOptions(merge: true));
  }

  // è·å–é”™é¢˜æœ¬
  Stream<List<WrongQuestionModel>> getWrongQuestions(String userId) {
    return _firestore
        .collection('users')
        .doc(userId)
        .collection('wrongQuestions')
        .where('isResolved', isEqualTo: false)
        .snapshots()
        .map((snapshot) => snapshot.docs
            .map((doc) => WrongQuestionModel.fromJson(doc.data()))
            .toList());
  }

  // æ›´æ–°å­¦ä¹ è¿›åº¦
  Future<void> updateProgress({
    required String userId,
    required String topic,
    required bool isCorrect,
  }) async {
    await _firestore
        .collection('users')
        .doc(userId)
        .collection('progress')
        .doc(topic)
        .set({
      'topic': topic,
      'totalAnswered': FieldValue.increment(1),
      'correctCount': isCorrect ? FieldValue.increment(1) : FieldValue.increment(0),
      'lastUpdated': DateTime.now().toIso8601String(),
    }, SetOptions(merge: true));
  }
}
```

#### 4.3 æœ¬åœ°ç¼“å­˜ç­–ç•¥

```dart
// lib/data/services/cache_service.dart
class CacheService {
  final _cacheBox = Hive.box('cache');

  void cacheQuestion(String questionId, QuestionModel question) {
    _cacheBox.put(questionId, question.toJson());
  }

  QuestionModel? getCachedQuestion(String questionId) {
    final data = _cacheBox.get(questionId);
    if (data != null) {
      return QuestionModel.fromJson(data);
    }
    return null;
  }

  void clearOldCache({Duration maxAge = const Duration(days: 7)}) {
    final cutoffDate = DateTime.now().subtract(maxAge);
    _cacheBox.keys.forEach((key) {
      final metadata = _cacheBox.get('${key}_metadata');
      if (metadata != null) {
        final cachedDate = DateTime.parse(metadata['cachedAt']);
        if (cachedDate.isBefore(cutoffDate)) {
          _cacheBox.delete(key);
          _cacheBox.delete('${key}_metadata');
        }
      }
    });
  }
}
```

---

## ğŸ§ª æµ‹è¯•ç­–ç•¥

### å•å…ƒæµ‹è¯•

**Flutter æµ‹è¯•**:
```dart
// è¿è¡Œæµ‹è¯•
flutter test

// è¦†ç›–ç‡æŠ¥å‘Š
flutter test --coverage
genhtml coverage/lcov.info -o coverage/html
```

**Node.js æµ‹è¯•**:
```typescript
// package.json
{
  "scripts": {
    "test": "jest",
    "test:watch": "jest --watch",
    "test:coverage": "jest --coverage"
  }
}

// tsconfig.json
{
  "compilerOptions": {
    "types": ["jest"]
  }
}
```

### é›†æˆæµ‹è¯•

```dart
// integration_test/app_test.dart
void main() {
  testWidgets('å®Œæ•´ç­”é¢˜æµç¨‹', (WidgetTester tester) async {
    await tester.pumpWidget(MyApp());

    // 1. é€‰æ‹©ä¸»é¢˜
    await tester.tap(find.text('JavaScript'));
    await tester.pumpAndSettle();

    // 2. ç­‰å¾…é¢˜ç›®åŠ è½½
    await tester.pumpAndSettle(Duration(seconds: 2));

    // 3. é€‰æ‹©ç­”æ¡ˆ
    await tester.tap(find.text('A').first);
    await tester.pumpAndSettle();

    // 4. æäº¤ç­”æ¡ˆ
    await tester.tap(find.text('æäº¤'));
    await tester.pumpAndSettle();

    // 5. éªŒè¯åé¦ˆæ˜¾ç¤º
    expect(find.text('å›ç­”æ­£ç¡®!'), findsOneWidget);
  });
}
```

---

## ğŸš€ CI/CD æµç¨‹

### GitHub Actions é…ç½®

```yaml
# .github/workflows/flutter-ci.yml
name: Flutter CI

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Setup Flutter
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.24.0'

      - name: Install dependencies
        run: flutter pub get

      - name: Run tests
        run: flutter test --coverage

      - name: Upload coverage
        uses: codecov/codecov-action@v3
        with:
          files: coverage/lcov.info

      - name: Build APK
        run: flutter build apk --release
```

### BFF CI/CD

```yaml
# .github/workflows/bff-ci.yml
name: BFF CI

on:
  push:
    paths:
      - 'bff/**'
    branches: [ main, develop ]

jobs:
  test:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v3

      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: '20'

      - name: Install dependencies
        working-directory: ./bff
        run: npm ci

      - name: Run linter
        working-directory: ./bff
        run: npm run lint

      - name: Run tests
        working-directory: ./bff
        run: npm test

      - name: Build
        working-directory: ./bff
        run: npm run build
```

---

## ğŸ“š æœ€ä½³å®è·µæ€»ç»“

### å¼€å‘è§„èŒƒ

1. **ä»£ç é£æ ¼**
   - Dart/Flutter ä½¿ç”¨å®˜æ–¹ lint è§„åˆ™
   - TypeScript ä½¿ç”¨ ESLint + Prettier
   - ç»„ä»¶ä¸æ–‡ä»¶å‘½åæ¸…æ™°è¡¨è¾¾èŒè´£

2. **æ¶æ„åŸåˆ™**
   - å®¢æˆ·ç«¯åˆ†å±‚: UI / çŠ¶æ€ / æ•°æ®
   - BFF è´Ÿè´£: é‰´æƒã€é™æµã€æ¨¡æ¿ã€æ ¡éªŒã€ç¼“å­˜
   - Prompt ç»“æœå¿…é¡»ç»“æ„åŒ– JSON

3. **æµ‹è¯•ä¼˜å…ˆ**
   - TDD ä¸ºé»˜è®¤å¼€å‘æ–¹å¼
   - å•å…ƒæµ‹è¯•è¦†ç›–æ ¸å¿ƒé€»è¾‘
   - é›†æˆæµ‹è¯•éªŒè¯å®Œæ•´æµç¨‹

4. **Git å·¥ä½œæµ**
   - çŸ­åˆ†æ”¯å¼€å‘
   - OpenSpec ææ¡ˆé©±åŠ¨
   - åˆå¹¶å‰ç¡®ä¿æµ‹è¯•é€šè¿‡

### æ€§èƒ½ä¼˜åŒ–

1. **å‰ç«¯ä¼˜åŒ–**
   - å›¾ç‰‡æ‡’åŠ è½½
   - åˆ—è¡¨åˆ†é¡µåŠ è½½
   - æœ¬åœ°ç¼“å­˜ç­–ç•¥

2. **åç«¯ä¼˜åŒ–**
   - API å“åº”ç¼“å­˜
   - è¯·æ±‚åˆå¹¶ä¸æ‰¹å¤„ç†
   - CDN é™æ€èµ„æº

3. **AI è°ƒç”¨ä¼˜åŒ–**
   - Prompt æ¨¡æ¿åŒ–å‡å°‘é‡å¤
   - æµå¼å“åº”æå‡ä½“éªŒ
   - é™çº§æ–¹æ¡ˆåº”å¯¹è¶…æ—¶

### å®‰å…¨è€ƒè™‘

1. **API å®‰å…¨**
   - JWT é‰´æƒ
   - è¯·æ±‚ç­¾åéªŒè¯
   - æ•æ„Ÿæ•°æ®åŠ å¯†

2. **Prompt å®‰å…¨**
   - è¾“å…¥è¿‡æ»¤ä¸æ ¡éªŒ
   - è¾“å‡ºæ ¼å¼ä¸¥æ ¼éªŒè¯
   - æ•æ„Ÿä¿¡æ¯å±è”½

---

## ğŸ“– å‚è€ƒèµ„æº

### Flutter å®˜æ–¹æ–‡æ¡£
- [Flutter AI æ¦‚è§ˆ](https://docs.fluttercn.cn/resources/ai-overview)
- [æ„å»ºç”± Gemini æä¾›æ”¯æŒçš„ Flutter åº”ç”¨](https://codelabs.developers.google.com/codelabs/flutter-gemini-colorist?hl=zh-cn)

### Gemini AI é›†æˆ
- [Flutter ä¸ AI æ·±åº¦é›†æˆå®æˆ˜æŒ‡å—](https://blog.csdn.net/2501_94436368/article/details/156061623)
- [Flutter Gemini å®æˆ˜æ¡ˆä¾‹](https://ducafecat.com/blog/flutter-gemini-ai-integration)

### BFF æ¶æ„å®è·µ
- [Nodejs BFF å¼€å‘å¿ƒå¾—å†ç¨‹](https://cloud.tencent.cn/developer/article/1600197)
- [æºç¨‹åº¦å‡åŸºäº TypeScript çš„ BFF è®¾è®¡ä¸å®è·µ](https://www.cnblogs.com/sexintercourse/p/17668926.html)

### å…¨æ ˆå¼€å‘
- [Flutter Web åº”ç”¨å¼€å‘ä¸éƒ¨ç½²](https://blog.csdn.net/codau/article/details/147348715)
- [2025 Flutter å…¨æ ˆå¼€å‘è¯¾ç¨‹](https://edu.51cto.com/topic/6511.html)

---

## âœ… éªŒæ”¶æ ‡å‡†

### M1: åŸºç¡€ UI åŸå‹
- [ ] ç”¨æˆ·å¯å®Œæˆå®Œæ•´ç­”é¢˜å¾ªç¯
- [ ] æ­£ç¡®/é”™è¯¯çŠ¶æ€æ­£ç¡®æ˜¾ç¤º
- [ ] æµ‹è¯•è¦†ç›–ç‡ > 80%

### M2: AI é›†æˆ
- [ ] Gemini API æˆåŠŸç”Ÿæˆé¢˜ç›®
- [ ] è§£æã€åŠ©è®°ã€åœºæ™¯å®Œæ•´è¿”å›
- [ ] é”™è¯¯å¤„ç†ä¸é™çº§æ–¹æ¡ˆå°±ç»ª

### M3: UI ä¼˜åŒ–
- [ ] å¤šé‚»å›½é£æ ¼è§†è§‰ä¸€è‡´æ€§
- [ ] åŠ¨ç”»æµç•…è‡ªç„¶
- [ ] å¤šå°ºå¯¸è®¾å¤‡é€‚é…å®Œæˆ

### M4: æ•°æ®æŒä¹…åŒ–
- [ ] Firestore é›†æˆæˆåŠŸ
- [ ] é”™é¢˜æœ¬åŠŸèƒ½å¯ç”¨
- [ ] å­¦ä¹ è¿›åº¦æ­£ç¡®è®°å½•ä¸å±•ç¤º

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025-01-26
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0

# 八股斩 - 里程碑详细规划

基于《前后端实施流程报告》，将每个里程碑拆解为具体可执行的任务。

---

## 📊 里程碑概览

| 里程碑 | 目标 | 预估周期 | 依赖 |
|--------|------|----------|------|
| M1 | 基础 UI 原型（固定数据） | 1-2 周 | 无 |
| M2 | 接入 BFF + 数据库 | 2-3 周 | M1 |
| M3 | UI 视觉与交互优化 | 1-2 周 | M1 |
| M4 | 数据持久化 + 题库管理 | 2 周 | M2 |

> **注意**: M2 和 M3 可并行开发（前端/后端分离），但 M3 的最终集成需要 M2 完成。

---

## 🏁 里程碑 M1：基础 UI 原型（固定数据）

**目标**: 用户可完成完整答题循环，反馈正确/错误状态

### 阶段 1.1：环境与项目初始化

- [ ] **1.1.1** 确认 Flutter 环境 (`flutter doctor`)
- [ ] **1.1.2** 创建 Flutter 项目 `baguzhan`
- [ ] **1.1.3** 配置 `pubspec.yaml` 核心依赖
  - provider (状态管理)
  - dio (网络请求，M2 用)
  - shared_preferences (本地存储)
  - flutter_svg (SVG 图标)
- [ ] **1.1.4** 创建项目目录结构
  ```
  lib/
  ├── core/           # 常量、主题、工具
  ├── data/           # 模型、仓储、数据源
  ├── domain/         # 实体、用例
  ├── presentation/   # 页面、组件、状态
  └── tests/          # 测试
  ```
- [ ] **1.1.5** 配置代码规范 (analysis_options.yaml)

### 阶段 1.2：数据模型定义

- [ ] **1.2.1** 创建 `QuestionModel` 类
  - 字段: id, content, topic, difficulty, explanation, mnemonic, scenario, tags, options
  - 实现 `fromJson()` 工厂方法
  - 实现 `correctAnswerIndex` getter
- [ ] **1.2.2** 创建 `OptionModel` 类
  - 字段: id, optionText, optionOrder, isCorrect
  - 实现 `fromJson()` 工厂方法
- [ ] **1.2.3** 创建 `UserAnswerModel` 类
  - 字段: questionId, selectedOptionIndex, isCorrect, answeredAt
- [ ] **1.2.4** 编写数据模型单元测试

### 阶段 1.3：固定数据源

- [ ] **1.3.1** 创建 `LocalQuestionDatasource` 类
- [ ] **1.3.2** 编写至少 5 道 JavaScript 基础题
- [ ] **1.3.3** 编写至少 3 道 React/Vue 题
- [ ] **1.3.4** 确保每道题包含完整的解析、助记和场景
- [ ] **1.3.5** 创建 `QuestionRepository` 接口和本地实现

### 阶段 1.4：状态管理

- [ ] **1.4.1** 创建 `QuestionProvider` 状态管理类
  - 实现 `loadQuestions(topic)` 方法
  - 实现 `selectOption(questionId, optionIndex)` 方法
  - 实现 `submitAnswer()` 方法
  - 实现 `nextQuestion()` 方法
  - 管理 isLoading, currentQuestionIndex, selectedAnswers, results 状态
- [ ] **1.4.2** 编写 QuestionProvider 单元测试
  - 测试初始状态
  - 测试加载题目
  - 测试选择选项
  - 测试提交答案判断正确性
  - 测试切换下一题

### 阶段 1.5：UI 页面开发

- [ ] **1.5.1** 创建应用主题 `AppTheme`
  - 定义多邻国风格配色方案
  - 定义字体样式
  - 定义组件默认样式
- [ ] **1.5.2** 创建首页 `HomePage`
  - 主题选择列表 (JavaScript, React, Vue, etc.)
  - 每日一题入口
  - 个人进度展示区（M4 完善）
- [ ] **1.5.3** 创建答题页 `QuestionPage`
  - 题目进度条
  - 题目内容卡片
  - 选项列表
  - 提交/下一题按钮
- [ ] **1.5.4** 创建结果页 `ResultPage`
  - 本轮答题统计
  - 正确率展示
  - 错题回顾入口
  - 重新开始/返回首页按钮

### 阶段 1.6：UI 组件开发

- [ ] **1.6.1** 创建 `QuestionCard` 组件
  - 题目内容展示
  - 难度标签
  - 标签展示
- [ ] **1.6.2** 创建 `OptionCard` 组件
  - 选项内容
  - 选中/未选中状态
  - 正确/错误反馈状态
  - 选项字母标识 (A/B/C/D)
- [ ] **1.6.3** 创建 `ProgressBar` 组件
  - 当前进度展示
  - 题目编号
- [ ] **1.6.4** 创建 `FeedbackPanel` 组件
  - 正确/错误反馈
  - 答案解析展示
  - 助记口诀展示
  - 实战场景展示

### 阶段 1.7：路由与导航

- [ ] **1.7.1** 配置 Navigator 路由
- [ ] **1.7.2** 实现页面间参数传递
- [ ] **1.7.3** 实现返回逻辑与确认弹窗

### 阶段 1.8：Widget 测试

- [ ] **1.8.1** 编写 OptionCard 组件测试
- [ ] **1.8.2** 编写 QuestionPage 集成测试
- [ ] **1.8.3** 编写完整答题流程测试

### M1 验收标准

- [ ] 可选择主题进入答题
- [ ] 可浏览题目并选择答案
- [ ] 提交后显示正确/错误反馈
- [ ] 可查看答案解析
- [ ] 完成一轮答题后显示统计结果
- [ ] 所有测试通过

---

## 🔌 里程碑 M2：接入 BFF + 数据库

**目标**: 从数据库读取题目，支持筛选和随机获取

### 阶段 2.1：BFF 项目初始化

- [ ] **2.1.1** 创建 BFF 项目目录 `baguzhan-bff`
- [ ] **2.1.2** 初始化 Node.js 项目 (`npm init`)
- [ ] **2.1.3** 安装核心依赖
  - express, typescript, @types/node, @types/express, ts-node
  - pg, @types/pg (PostgreSQL)
  - dotenv, cors, express-rate-limit
- [ ] **2.1.4** 安装开发依赖
  - eslint, prettier, jest, @types/jest, ts-jest, nodemon
- [ ] **2.1.5** 配置 TypeScript (`tsconfig.json`)
- [ ] **2.1.6** 配置 ESLint 和 Prettier
- [ ] **2.1.7** 创建 BFF 项目目录结构

### 阶段 2.2：数据库设计与初始化

- [ ] **2.2.1** 选择数据库托管方案
  - 本地 PostgreSQL (开发)
  - Supabase / Neon / Railway (生产)
- [ ] **2.2.2** 创建数据库迁移脚本 `001_init.sql`
  - questions 表
  - options 表
  - user_answers 表
  - user_wrong_questions 表
  - user_progress 表
  - tags 表
- [ ] **2.2.3** 创建索引
  - topic, difficulty 索引
  - tags GIN 索引
  - 全文搜索索引 (中文)
- [ ] **2.2.4** 编写数据库连接配置 `database.ts`
- [ ] **2.2.5** 创建初始题库数据 `questions.json`
- [ ] **2.2.6** 编写题库导入脚本 `import-questions.ts`

### 阶段 2.3：题库服务开发

- [ ] **2.3.1** 创建 `QuestionRepository` 类
  - `getQuestions(filters)` - 支持 topic/difficulty/tags/limit/random
  - `getQuestionById(id)`
  - `searchQuestions(term)` - 全文搜索
  - `getQuestionStats()` - 统计信息
- [ ] **2.3.2** 创建 `CacheService` 类
  - 内存缓存实现
  - get/set/delete/clear 方法
  - 自动过期清理
- [ ] **2.3.3** 创建 `QuestionService` 类
  - `getQuestions(filters)` - 带缓存
  - `getDailyQuestion()` - 每日一题
  - `searchQuestions(term)`
  - `getStats()`

### 阶段 2.4：API 路由开发

- [ ] **2.4.1** 创建健康检查路由 `/health`
- [ ] **2.4.2** 创建题目 API 路由 `/api/questions`
  - `GET /` - 获取题目列表
  - `GET /daily` - 获取每日一题
  - `GET /search` - 搜索题目
  - `GET /stats` - 获取统计
  - `GET /:id` - 获取单个题目

### 阶段 2.5：中间件开发

- [ ] **2.5.1** 创建错误处理中间件 `errorHandler.ts`
- [ ] **2.5.2** 创建限流中间件 `rateLimit.ts`
  - 题目 API: 60次/分钟
  - 用户操作 API: 20次/分钟
- [ ] **2.5.3** 创建请求日志中间件
- [ ] **2.5.4** 创建 CORS 配置

### 阶段 2.6：主应用入口

- [ ] **2.6.1** 创建 `index.ts` 主入口
- [ ] **2.6.2** 配置中间件加载顺序
- [ ] **2.6.3** 配置路由挂载
- [ ] **2.6.4** 创建启动脚本 (`npm run dev`, `npm run build`, `npm start`)

### 阶段 2.7：BFF 测试

- [ ] **2.7.1** 编写 QuestionRepository 单元测试
- [ ] **2.7.2** 编写 QuestionService 单元测试
- [ ] **2.7.3** 编写 API 路由集成测试
- [ ] **2.7.4** 配置测试数据库环境

### 阶段 2.8：Flutter 客户端集成

- [ ] **2.8.1** 创建 `ApiClient` 类 (基于 Dio)
  - 基础 URL 配置
  - 错误处理
  - 超时配置
- [ ] **2.8.2** 重构 `QuestionRepository` 实现 API 调用
  - `getQuestions(topic, difficulty, limit, random)`
  - `getDailyQuestion()`
  - `searchQuestions(keyword)`
  - `getStats()`
- [ ] **2.8.3** 添加网络错误处理与重试逻辑
- [ ] **2.8.4** 实现离线缓存策略

### 阶段 2.9：环境配置

- [ ] **2.9.1** 创建 `.env.example` 模板
- [ ] **2.9.2** 配置开发/测试/生产环境变量
- [ ] **2.9.3** 更新 `.gitignore`

### M2 验收标准

- [ ] BFF 服务可正常启动
- [ ] 数据库表结构正确创建
- [ ] 可通过 API 获取题目列表
- [ ] 支持按主题/难度筛选
- [ ] 支持随机获取题目
- [ ] 全文搜索功能正常
- [ ] Flutter 客户端成功对接 BFF
- [ ] 网络错误有友好提示
- [ ] 所有测试通过

---

## 🎨 里程碑 M3：UI 视觉与交互优化

**目标**: UI 视觉与交互达到多邻国风格一致的轻松感与流畅体验

### 阶段 3.1：设计系统完善

- [ ] **3.1.1** 完善配色方案
  - 主色: #58CC02 (正确绿)
  - 错误色: #FF4B4B
  - 主题蓝: #1CB0F6
  - 中性色系: #FFFFFF, #F7F7F7, #E5E5E5, #AFAFAF, #777777, #3C3C3C
- [ ] **3.1.2** 定义字体层级
  - 标题样式
  - 正文样式
  - 按钮样式
  - 标签样式
- [ ] **3.1.3** 定义间距系统 (4px 基准)
- [ ] **3.1.4** 定义圆角规范 (16px 大, 8px 中, 4px 小)
- [ ] **3.1.5** 定义阴影规范

### 阶段 3.2：组件视觉优化

- [ ] **3.2.1** 优化 OptionCard 视觉
  - 选中态动画
  - 正确/错误状态动画
  - 触摸反馈
- [ ] **3.2.2** 优化 QuestionCard 视觉
  - 难度标签样式
  - 标签 chip 样式
- [ ] **3.2.3** 优化 ProgressBar 视觉
  - 进度动画
  - 颜色渐变
- [ ] **3.2.4** 优化按钮组件
  - 主按钮样式
  - 次按钮样式
  - 禁用态样式

### 阶段 3.3：交互动画

- [ ] **3.3.1** 实现选项选中动画
  - 缩放反馈
  - 边框颜色过渡
- [ ] **3.3.2** 实现答案反馈动画
  - 正确: 弹跳 + 绿色高亮
  - 错误: 抖动 + 红色高亮
- [ ] **3.3.3** 实现页面转场动画
  - 滑动过渡
  - 淡入淡出
- [ ] **3.3.4** 实现加载动画
  - 骨架屏
  - Shimmer 效果
- [ ] **3.3.5** 实现成就/连击动画
  - 连续正确反馈
  - 完成一轮庆祝动画

### 阶段 3.4：反馈面板优化

- [ ] **3.4.1** 设计反馈面板布局
  - 正确/错误状态区分
  - 解析内容排版
  - 助记口诀高亮
  - 实战场景卡片
- [ ] **3.4.2** 实现底部滑出动画
- [ ] **3.4.3** 添加展开/收起功能

### 阶段 3.5：响应式布局

- [ ] **3.5.1** 适配不同屏幕尺寸
- [ ] **3.5.2** 适配横竖屏
- [ ] **3.5.3** 适配平板设备
- [ ] **3.5.4** 安全区域适配 (刘海屏/底部手势条)

### 阶段 3.6：可访问性

- [ ] **3.6.1** 添加语义化标签
- [ ] **3.6.2** 支持系统字体缩放
- [ ] **3.6.3** 确保颜色对比度符合 WCAG 标准
- [ ] **3.6.4** 添加屏幕阅读器支持

### M3 验收标准

- [ ] 整体视觉风格统一，符合多邻国风格
- [ ] 所有交互有流畅动画反馈
- [ ] 正确/错误反馈清晰明确
- [ ] 不同设备尺寸显示正常
- [ ] 加载状态有友好提示

---

## 💾 里程碑 M4：数据持久化 + 题库管理

**目标**: 错题本与学习进度可持久化与检索，以及题库管理功能

### 阶段 4.1：用户认证 (可选)

- [ ] **4.1.1** 选择认证方案
  - 匿名用户 (设备 ID)
  - 第三方登录 (Google/Apple)
  - 自建账号系统
- [ ] **4.1.2** 实现认证中间件 `auth.ts`
- [ ] **4.1.3** 生成用户 ID 策略

### 阶段 4.2：用户数据服务 (BFF)

- [ ] **4.2.1** 创建 `UserRepository` 类
  - `recordAnswer()` - 记录答题
  - `addToWrongQuestions()` - 加入错题本
  - `getWrongQuestions()` - 获取错题列表
  - `markWrongQuestionResolved()` - 标记已掌握
  - `updateProgress()` - 更新进度
  - `getUserProgress()` - 获取进度
  - `getUserStats()` - 获取统计
- [ ] **4.2.2** 创建 `ProgressService` 类
- [ ] **4.2.3** 创建 `WrongQuestionService` 类

### 阶段 4.3：用户数据 API

- [ ] **4.3.1** 创建进度 API `/api/progress`
  - `GET /` - 获取用户进度
  - `GET /stats` - 获取用户统计
- [ ] **4.3.2** 创建错题 API `/api/wrong-questions`
  - `GET /` - 获取错题列表
  - `POST /:id/resolve` - 标记已掌握
- [ ] **4.3.3** 创建答题记录 API `/api/answers`
  - `POST /` - 提交答题记录

### 阶段 4.4：题库管理 API (管理后台)

- [ ] **4.4.1** 创建管理员认证
- [ ] **4.4.2** 创建题目管理 API `/api/admin/questions`
  - `POST /` - 创建题目
  - `PUT /:id` - 更新题目
  - `DELETE /:id` - 删除题目 (软删除)
- [ ] **4.4.3** 创建题库导入 API
  - `POST /import` - 批量导入题目
- [ ] **4.4.4** 创建标签管理 API

### 阶段 4.5：Flutter 客户端集成

- [ ] **4.5.1** 创建 `UserService` 类
- [ ] **4.5.2** 创建 `ProgressRepository` 类
- [ ] **4.5.3** 创建 `WrongQuestionRepository` 类
- [ ] **4.5.4** 实现答题自动上报

### 阶段 4.6：错题本功能

- [ ] **4.6.1** 创建错题本页面 `WrongQuestionsPage`
- [ ] **4.6.2** 实现错题列表展示
- [ ] **4.6.3** 实现错题复习模式
- [ ] **4.6.4** 实现标记已掌握功能
- [ ] **4.6.5** 实现错题筛选 (按主题/时间)

### 阶段 4.7：学习进度功能

- [ ] **4.7.1** 创建进度页面 `ProgressPage`
- [ ] **4.7.2** 实现各主题正确率展示
- [ ] **4.7.3** 实现连击记录展示
- [ ] **4.7.4** 实现学习历史图表
- [ ] **4.7.5** 集成到首页

### 阶段 4.8：本地数据同步

- [ ] **4.8.1** 实现本地数据库 (SQLite/Hive)
- [ ] **4.8.2** 实现离线答题记录
- [ ] **4.8.3** 实现网络恢复后自动同步
- [ ] **4.8.4** 处理数据冲突

### 阶段 4.9：测试

- [ ] **4.9.1** 编写 UserRepository 单元测试
- [ ] **4.9.2** 编写进度/错题 API 集成测试
- [ ] **4.9.3** 编写 Flutter 同步逻辑测试

### M4 验收标准

- [ ] 答题记录可正确上报并保存
- [ ] 错题自动加入错题本
- [ ] 可查看和复习错题
- [ ] 可标记错题为已掌握
- [ ] 学习进度正确统计并展示
- [ ] 离线答题后可同步数据
- [ ] 所有测试通过

---

## 🚀 后续里程碑 (M5+)

以下为可选的后续功能规划：

### M5: 社交与游戏化
- 排行榜系统
- 成就徽章
- 每日挑战
- 分享功能

### M6: AI 增强
- AI 出题 (根据用户薄弱点)
- AI 解析生成
- 智能复习推荐

### M7: 生产发布
- App Store / Google Play 上架
- 性能监控接入
- 错误追踪 (Sentry)
- 用户分析 (Firebase Analytics)

---

## 📝 开发约定

### Git 分支策略
- `main` - 生产分支
- `develop` - 开发分支
- `feature/m1-xxx` - 功能分支

### 提交信息格式
```
feat(m1): 添加 QuestionModel 数据模型
fix(m2): 修复题目筛选逻辑
docs: 更新里程碑规划文档
```

### 代码审查
- 每个阶段完成后进行代码审查
- 合并前确保测试通过

---

*文档版本: v1.0*
*最后更新: 2026-01-26*

# 设备 ID 认证规范

## 新增需求

### 需求：设备 ID 生成

系统必须在应用首次启动时生成唯一的设备标识符，并持久化存储。

#### 场景：首次启动生成设备 ID
- **当** 用户首次启动应用
- **那么** 系统生成 UUID v4 格式的设备 ID
- **并且** 设备 ID 被存储到本地持久化存储中
- **并且** 设备 ID 符合 RFC 4122 标准

#### 场景：后续启动使用已有设备 ID
- **当** 用户再次启动应用且本地已有设备 ID
- **那么** 系统使用已存储的设备 ID
- **并且** 不生成新的设备 ID

#### 场景：设备 ID 格式验证
- **当** 系统生成设备 ID
- **那么** 设备 ID 必须是 36 字符的 UUID 格式（xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx）

### 需求：设备 ID 传递

系统必须在所有 API 请求中自动附加设备 ID。

#### 场景：API 请求附加设备 ID
- **当** 客户端发起任何 API 请求
- **那么** 请求必须包含 `X-Device-ID` HTTP Header
- **并且** Header 值为存储的设备 ID

#### 场景：设备 ID 缺失时的处理
- **当** API 请求未包含 `X-Device-ID` Header
- **那么** 后端返回 400 Bad Request 错误
- **并且** 错误消息说明缺少设备 ID

### 需求：用户数据关联

系统必须使用设备 ID 作为用户标识来关联和存储用户数据。

#### 场景：答题记录关联
- **当** 用户提交答题记录
- **那么** 记录必须关联到请求的设备 ID
- **并且** 后续同一设备可以查询到该记录

#### 场景：错题本关联
- **当** 用户答错题目
- **那么** 错题记录必须关联到请求的设备 ID
- **并且** 后续同一设备可以查询到该错题

#### 场景：学习进度关联
- **当** 用户的学习进度发生变化
- **那么** 进度数据必须关联到请求的设备 ID
- **并且** 后续同一设备可以获取到最新进度

### 需求：设备 ID 验证

后端必须验证设备 ID 的格式有效性。

#### 场景：有效设备 ID
- **当** API 请求包含有效格式的设备 ID
- **那么** 请求被正常处理
- **并且** 返回预期的响应数据

#### 场景：无效设备 ID
- **当** API 请求包含无效格式的设备 ID
- **那么** 后端返回 400 Bad Request
- **并且** 错误消息说明设备 ID 格式无效
